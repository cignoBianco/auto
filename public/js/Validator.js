define(["jquery"],function(a){function e(e,t,r){r||a(e).closest(".validator-container").find('[data-constraint-type="'+t+'"]').show(),a(e).addClass("input-error"),a(e).closest(".validator-container").find(".select2-selection").addClass("input-error"),a(e).closest(".validator-container").find(".jq-selectbox__select").addClass("input-error"),a(e).closest(".validator-container").find(".jq-number").addClass("input-error"),a(e).closest(".validator-container").find(".search-field").addClass("input-error"),a(e).closest(".validator-container").find(".scroll-wrapper").addClass("input-error"),a(e).closest(".validator-container").find(".form-count__input").addClass("input-error")}var t={lengthMax:"Слишком длинное значение",notBlanc:"Это поле должно быть заполнено",notBlank:"Это поле должно быть заполнено",year:"Некорректное значение",vin:"Некорректный VIN",email:"Некорректный Email",phone:"Некорректный номер телефона",regex:"Некорректное значение",notNegative:"Число не может быть отрицательным",promocode:"Некорректный промокод",moreThan:"Значение должно быть больше {constraintMt}",lessThan:"Значение должно быть меньше {constraintLt}",site:"Введите корректное имя сайта"};a(".openCreateTemplate").on("click",function(){a("[data-constraint-type]").hide(),a(".input-error").removeClass("input-error"),a(".duplicate-error").css("display","none")}),a.fn.valid=function(t){var r=t&&t.withoutMessage,s=t&&t.specificConstraint,n=Routing.generate("validator"),i=this,o=!t||!t.hasOwnProperty("predefinedValue")||t.predefinedValue;return a.each(a(this).data("constraint"),function(t,l){if(s&&s!==l)return!0;switch(l){case"lengthMax":var c=a(i).data("constraint-max");a(i).val().length>=c&&(a(i).trigger("test"),e(i,l,r),o=!1);break;case"regex":var d=a(i).data("constraint-regex-pattern");""===a(i).val()||a(i).val().match(new RegExp(d,"igm"))||(e(i,l,r),o=!1);break;case"notBlank":case"notBlanc":a(i).val()&&""!==a(i).val()&&0!==a(i).val().length||(e(i,l,r),o=!1);break;case"moreThan":var v=a(i).data("constraintMt");a(i).val()&&a(i).val()>v||(e(i,l,r),o=!1);break;case"lessThan":var p=a(i).data("constraintLt");a(i).val()&&a(i).val()<p||(e(i,l,r),o=!1);break;case"site":""===a(i).val()||a(i).val().match(/^https?:\/\/\S+\.\S+$/)||(e(i,l,r),o=!1);break;case"year":var h=(new Date).getFullYear();""!==a(i).val()&&(!a(i).val().match(/^(19[0-9]{2}|2[0-9]{3})$/)||parseInt(a(i).val())>h)&&(e(i,l,r),o=!1);break;case"vin":""===a(i).val()||a(i).val().toUpperCase().match("^[0-9A-HJ-NPR-Z]{17}$")||(e(i,l,r),o=!1);break;case"phone":""===a(i).val()||a(i).val().match(/^\+\d \(\d{3}\) \d{3}-\d{2}-\d{2}?.*$/)||(e(i,l,r),o=!1);break;case"promocode":o||e(i,l,r);break;case"email":""===a(i).val()||a(i).val().match(/^(?!.*[-._]{2,})(?!.*?_.*?_.*?_.*?_.*?_.*?_)(?!.*?-.*?-.*?-.*?-)(?!.*?\..*?\..*?\..*?\..*?\.)(?!.*[-._]+$)[-._a-zа-яё0-9]{1,30}@[-._a-zа-яё0-9]{1,50}$/gim)&&a(i).val().match(/^(([a-zа-яё0-9]+|[a-zа-яё0-9][-._a-zа-яё0-9]*[a-zа-яё0-9])@([a-zа-яё0-9]+\.|[a-zа-яё0-9][-._a-zа-яё0-9]*[a-zа-яё0-9]\.){1,4}[a-zа-я]{2,})$/gim)&&!a(i).val().match(/^(.*([0-9]{1,3}\.){3}[0-9]{1,3}.*)$/gim)||(e(i,l,r),o=!1);break;case"notNegative":""!==a(i).val()&&!isNaN(parseInt(a(i).val()))&&parseInt(a(i).val())<0&&(e(i,l,r),o=!1);break;default:a.post({url:n,dataType:"json",async:!1,data:{constraintType:l,value:a(i).val()},success:function(a){a.success||(e(i,l,r),o=!1)}})}}),o},a.fn.setConstraint=function(){var e=this;a(this).closest(".dropdown-select-search")[0]&&(e=a(this).closest(".dropdown-select-search")[0]),a(this).parent().hasClass("__checkbox")&&a(this).closest("label")[0]&&(e=a(this).closest("label")[0]),a(this).is('input[type="file"]')&&(e=a(this).closest("div")[0]),a(this).parent().hasClass("form-count")&&(e=a(this).parent());var r=a(this).closest(".jq-number")[0];r&&(e=r),a(e).wrap(a('<div class="validator-container"></div>')),a(e).on("change input",function(){a(e).closest(".validator-container").find("[data-constraint-type]").hide(),a(".text-error-all").hide(),a(e).removeClass("input-error").closest(".validator-container").find(".search-field").removeClass("input-error"),a(e).removeClass("input-error").closest(".validator-container").find(".scroll-wrapper").removeClass("input-error")});var s=a(this).data();return a.each(a(this).data("constraint"),function(r,n){if(!a(e).is(".scrollbar-outer")){var i=t[n];a.each(s,function(a,e){i=i.replace("{"+a+"}",e)}),a(e).after('<div class="error-note" data-constraint-type="'+n+'">'+i+"</div>")}}),a(".error-note").css("clear","both"),this}});