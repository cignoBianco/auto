(function(){!function(e,t,s){var r,n;"shapeshift",n={selector:"*",enableDrag:!0,enableCrossDrop:!0,enableResize:!0,enableTrash:!1,align:"center",colWidth:null,columns:null,minColumns:1,autoHeight:!0,maxHeight:null,minHeight:100,gutterX:10,gutterY:10,paddingX:10,paddingY:10,animated:!0,animateOnInit:!1,animationSpeed:225,animationThreshold:100,dragClone:!1,deleteClone:!0,dragRate:100,dragWhitelist:"*",crossDropWhitelist:"*",cutoffStart:null,cutoffEnd:null,handle:!1,cloneClass:"ss-cloned-child",activeClass:"ss-active-child",draggedClass:"ss-dragged-child",placeholderClass:"ss-placeholder-child",originalContainerClass:"ss-original-container",currentContainerClass:"ss-current-container",previousContainerClass:"ss-previous-container"},r=function(){function s(t,s){this.element=t,this.options=e.extend({},n,s),this.globals={},this.$container=e(t),this.errorCheck()&&this.init()}return s.prototype.errorCheck=function(){var e,t;return t=this.options,e=!1,"Shapeshift ERROR:",null===t.colWidth&&0===this.$container.children(t.selector).length&&(e=!0,console.error("Shapeshift ERROR: option colWidth must be specified if Shapeshift is initialized with no active children.")),!e},s.prototype.init=function(){return this.createEvents(),this.setGlobals(),this.setIdentifier(),this.setActiveChildren(),this.enableFeatures(),this.gridInit(),this.render(),this.afterInit()},s.prototype.createEvents=function(){var e,t=this;return this.options,(e=this.$container).off("ss-arrange").on("ss-arrange",function(e,s){return null==s&&(s=!1),t.render(!1,s)}),e.off("ss-rearrange").on("ss-rearrange",function(){return t.render(!0)}),e.off("ss-setTargetPosition").on("ss-setTargetPosition",function(){return t.setTargetPosition()}),e.off("ss-destroy").on("ss-destroy",function(){return t.destroy()})},s.prototype.setGlobals=function(){return this.globals.animated=this.options.animateOnInit},s.prototype.afterInit=function(){return this.globals.animated=this.options.animated},s.prototype.setIdentifier=function(){return this.identifier="shapeshifted_container_"+Math.random().toString(36).substring(7),this.$container.addClass(this.identifier)},s.prototype.enableFeatures=function(){if(this.options.enableResize&&this.enableResize(),this.options.enableDrag||this.options.enableCrossDrop)return this.enableDragNDrop()},s.prototype.setActiveChildren=function(){var t,s,r,n,i,o,a,l,h,d,p,c;for(a=this.options,t=this.$container.children(a.selector),s=a.activeClass,l=t.length,i=h=0;0<=l?h<l:h>l;i=0<=l?++h:--h)e(t[i]).addClass(s);for(this.setParsedChildren(),n=a.columns,c=[],i=d=0,p=this.parsedChildren.length;0<=p?d<p:d>p;i=0<=p?++d:--d)r=this.parsedChildren[i].colspan,o=a.minColumns,r>n&&r>o?(a.minColumns=r,c.push(console.error("Shapeshift ERROR: There are child elements that have a larger colspan than the minimum columns set through options.\noptions.minColumns has been set to "+r))):c.push(void 0);return c},s.prototype.setParsedChildren=function(){var t,s,r,n,i,o,a;for(o=(s=this.$container.find("."+this.options.activeClass).filter(":visible")).length,i=[],n=a=0;0<=o?a<o:a>o;n=0<=o?++a:--a)r={i:n,el:t=e(s[n]),colspan:parseInt(t.attr("data-ss-colspan"))||1,height:t.outerHeight()},i.push(r);return this.parsedChildren=i},s.prototype.gridInit=function(){var e,t,s,r,n;return r=this.options.gutterX,this.options.colWidth>=1?this.globals.col_width=this.options.colWidth+r:(s=this.parsedChildren[0],t=s.el.outerWidth(),e=s.colspan,n=(t-(e-1)*r)/e,this.globals.col_width=n+r)},s.prototype.render=function(e,t){return null==e&&(e=!1),this.setGridColumns(),this.arrange(e,t)},s.prototype.setGridColumns=function(){var e,t,s,r,n,i,o,a,l,h;switch(r=this.globals,l=this.options,t=r.col_width,i=l.gutterX,h=l.paddingX,o=this.$container.innerWidth()-2*h,a=l.minColumns,s=l.columns||Math.floor((o+i)/t),a&&a>s&&(s=a),r.columns=s,e=this.parsedChildren.length,s>e&&(s=e),r.child_offset=h,l.align){case"center":return n=s*t-i,r.child_offset+=(o-n)/2;case"right":return n=s*t-i,r.child_offset+=o-n}},s.prototype.arrange=function(e,t){var s,r,n,i,o,a,l,h,d,p,c,u,g,f,C,m,v,b;for(e&&this.setParsedChildren(),d=this.globals,f=this.options,r=this.$container,a=this.getPositions(),v=(C=this.parsedChildren).length,n=d.animated&&v<=f.animationThreshold,i=f.animationSpeed,h=f.draggedClass,p=b=0;0<=v?b<v:b>v;p=0<=v?++b:--b)s=C[p].el,o=a[p],(c=s.hasClass(h))&&(m=f.placeholderClass,s=s.siblings("."+m)),n&&!c?s.stop(!0,!1).animate(o,i,function(){}):s.css(o);if(t&&(n?setTimeout(function(){return r.trigger("ss-drop-complete")},i):r.trigger("ss-drop-complete")),r.trigger("ss-arranged"),f.autoHeight)return l=d.container_height,u=f.maxHeight,(g=f.minHeight)&&l<g?l=g:u&&l>u&&(l=u),r.height(l)},s.prototype.getPositions=function(e){var t,s,r,n,i,o,a,l,h,d,p,c,u,g,f,C,m,v=this;for(null==e&&(e=!0),n=this.globals,l=this.options,o=l.gutterY,h=l.paddingY,r=l.draggedClass,d=this.parsedChildren,f=d.length,t=[],a=C=0,m=n.columns;0<=m?C<m:C>m;a=0<=m?++C:--C)t.push(h);return u=function(e){var s,r,i,a,l,h,d;if(s=e.col,r=e.colspan,a=e.col*n.col_width+n.child_offset,l=t[s],p[e.i]={left:a,top:l},t[s]+=e.height+o,r>=1){for(d=[],i=h=1;1<=r?h<r:h>r;i=1<=r?++h:--h)d.push(t[s+i]=t[s]);return d}},s=function(e){var s,r,n,i,o,a,l,h,d,p,c,u;for(d=t.length-e.colspan+1,h=t.slice(0).splice(0,d),s=void 0,l=c=0;0<=d?c<d:c>d;l=0<=d?++c:--c){for(r=v.lowestCol(h,l),n=e.colspan,i=t[r],o=!0,p=u=1;1<=n?u<n:u>n;p=1<=n?++u:--u)if(a=t[r+p],i<a){o=!1;break}if(o){s=r;break}}return s},g=[],c=function(){var e,t,r,n,i,o,a,l,h;for(i=[],n=o=0,l=g.length;0<=l?o<l:o>l;n=0<=l?++o:--o)(r=g[n]).col=s(r),r.col>=0&&(u(r),i.push(n));for(h=[],t=a=i.length-1;a>=0;t=a+=-1)e=i[t],h.push(g.splice(e,1));return h},p=[],function(){var n,i,o;for(o=[],a=i=0;0<=f?i<f:i>f;a=0<=f?++i:--i)n=d[a],e||!n.el.hasClass(r)?(n.colspan>1?n.col=s(n):n.col=v.lowestCol(t),void 0===n.col?g.push(n):u(n),o.push(c())):o.push(void 0);return o}(),l.autoHeight&&(i=t[this.highestCol(t)]-o,n.container_height=i+h),p},s.prototype.enableDragNDrop=function(){var s,r,n,i,o,a,l,h,d,p,c,u,g,f,C,m,v,b,y=this;if(g=this.options,r=this.$container,o=g.activeClass,c=g.draggedClass,C=g.placeholderClass,f=g.originalContainerClass,l=g.currentContainerClass,m=g.previousContainerClass,h=g.deleteClone,p=g.dragRate,d=g.dragClone,a=g.cloneClass,i=n=s=b=v=null,u=!1,g.enableDrag&&r.children("."+o).filter(g.dragWhitelist).draggable({addClasses:!1,containment:"document",handle:g.handle,zIndex:9999,start:function(t,r){var o;return i=e(t.target),d&&(s=i.clone(!0).insertBefore(i).addClass(a)),i.addClass(c),o=i.prop("tagName"),n=e("<"+o+" class='"+C+"' style='height: "+i.height()+"px; width: "+i.width()+"'></"+o+">"),i.parent().addClass(f).addClass(l),b=i.outerHeight()/2,v=i.outerWidth()/2},drag:function(s,r){return u||d&&h&&e("."+l)[0]===e("."+f)[0]||(n.remove().appendTo("."+l),e("."+l).trigger("ss-setTargetPosition"),u=!0,t.setTimeout(function(){return u=!1},p)),r.position.left=s.pageX-i.parent().offset().left-v,r.position.top=s.pageY-i.parent().offset().top-b},stop:function(){var t,r,o;return r=e("."+f),t=e("."+l),o=e("."+m),i.removeClass(c),e("."+C).remove(),d&&(h&&e("."+l)[0]===e("."+f)[0]?(s.remove(),e("."+l).trigger("ss-rearrange")):s.removeClass(a)),r[0]===t[0]?t.trigger("ss-rearranged",i):(r.trigger("ss-removed",i),t.trigger("ss-added",i)),r.trigger("ss-arrange").removeClass(f),t.trigger("ss-arrange",!0).removeClass(l),o.trigger("ss-arrange").removeClass(m),i=n=null}}),g.enableCrossDrop)return r.droppable({accept:g.crossDropWhitelist,tolerance:"intersect",over:function(t){return e("."+m).removeClass(m),e("."+l).removeClass(l).addClass(m),e(t.target).addClass(l)},drop:function(t,s){var r,n,o;if(y.options.enableTrash)return n=e("."+f),r=e("."+l),o=e("."+m),i=e(s.helper),r.trigger("ss-trashed",i),i.remove(),n.trigger("ss-rearrange").removeClass(f),r.trigger("ss-rearrange").removeClass(l),o.trigger("ss-arrange").removeClass(m)}})},s.prototype.setTargetPosition=function(){var t,s,r,n,i,o,a,l,h,d,p,c,u,g,f,C,m,v,b,y,T,w;if((d=this.options).enableTrash)return c=this.options.placeholderClass,e("."+c).remove();if(h=d.draggedClass,t=e("."+h),s=t.parent(),p=this.parsedChildren,i=this.getPositions(!1),b=i.length,f=t.offset().left-s.offset().left+this.globals.col_width/2,C=t.offset().top-s.offset().top+t.height()/2,m=9999999,v=0,b>1){for(a=d.cutoffStart+1||0,o=d.cutoffEnd||b,u=w=a;a<=o?w<o:w>o;u=a<=o?++w:--w)(n=i[u])&&(T=f-n.left,y=C-n.top,T>0&&y>0&&(l=Math.sqrt(y*y+T*T))<m&&(m=l,v=u,u===b-1&&T>p[u].height/2&&v++));v===p.length?(r=p[v-1].el,t.insertAfter(r)):(r=p[v].el,t.insertBefore(r))}else 1===b?(n=i[0]).left<f?this.$container.append(t):this.$container.prepend(t):this.$container.append(t);return this.arrange(!0),s[0]!==t.parent()[0]?(g=d.previousContainerClass,e("."+g).trigger("ss-rearrange")):void 0},s.prototype.enableResize=function(){var s,r,n,i=this;return s=this.options.animationSpeed,n=!1,r="resize."+this.identifier,e(t).on(r,function(){if(!n)return n=!0,setTimeout(function(){return i.render()},s/3),setTimeout(function(){return i.render()},s/3),setTimeout(function(){return n=!1,i.render()},s/3)})},s.prototype.lowestCol=function(e,t){var s;return null==t&&(t=0),(s=e.map(function(e,t){return[e,t]})).sort(function(e,t){var s;return 0===(s=e[0]-t[0])&&(s=e[1]-t[1]),s}),s[t][1]},s.prototype.highestCol=function(s){return e.inArray(Math.max.apply(t,s),s)},s.prototype.destroy=function(){var e,t,s;return(t=this.$container).off("ss-arrange"),t.off("ss-rearrange"),t.off("ss-setTargetPosition"),t.off("ss-destroy"),s=this.options.activeClass,e=t.find("."+s),this.options.enableDrag&&e.draggable("destroy"),this.options.enableCrossDrop&&t.droppable("destroy"),e.removeClass(s),t.removeClass(this.identifier)},s}(),e.fn.shapeshift=function(s){return this.each(function(){var n,i,o;return(i=null!=(o=e(this).attr("class").match(/shapeshifted_container_\w+/))?o[0]:void 0)&&(n="resize."+i,e(t).off(n),e(this).removeClass(i)),e.data(this,"plugin_shapeshift",new r(this,s))})}}(jQuery,window,document)}).call(this);